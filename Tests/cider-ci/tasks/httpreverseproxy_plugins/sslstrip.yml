      tasks:
        sslstrip:
          timeout: 300
          name: SslStrip proxy plugin tests
          
          trial-attachments:
            logs:
             include-match: ^attachment[\w\d\-\_]*\.log$
             content-type: text/plain
          
          scripts:
            run_nuget_restore:   
              body: |
                start /w .nuget\nuget.exe restore
                echo nuget.exe error level is %ERRORLEVEL%
                exit /b %ERRORLEVEL%  

            build_testssslstrip:
              ignore-state: false
              start-when:
                - script: run_nuget_restore   
                  states: [passed]   
              body: |
                start /w msbuild tests\TestsSslStrip\TestsSslStrip.csproj /t:Clean,Build /p:Configuration="Debug" /p:Platform="Mixed Platforms" /p:OutputPath=bin\Debug /flp:Summary;Verbosity=minimal;LogFile=attachment-msbuild_testssslstrip_info.log /flp1:logfile=attachment-msbuild_testssslstrip_error.log;errorsonly /flp2:logfile=attachment-msbuild_testssslstrip_warning.log;warningsonly
                echo MSBuild error level is %ERRORLEVEL%
                exit /b %ERRORLEVEL%                                
              
            tests_httpreverseproxyclientrequest:
              ignore-state: false
              start-when:
                - script: build_testssslstrip   
                  states: [passed]                
              body: |
                nunit3-console tests\TestsSslStrip\bin\debug\TestsSslStrip.dll --output=attachment-nunit-info-sslstrip_httpreverseproxyclientrequest.log --err=attachment-nunit-error-sslstrip_httpreverseproxyclientrequest.log --framework=4.0 --noresult --noheader --test=httpreverseproxyclientrequest
                echo msbuild error level is %errorlevel%
                exit /b %errorlevel%
                                
              
            tests_httpreverseproxyserverresponse:
              ignore-state: false
              start-when:
                - script: build_testssslstrip   
                  states: [passed]                
              body: |
                nunit3-console tests\TestsSslStrip\bin\debug\TestsSslStrip.dll --output=attachment-nunit-info-sslstrip_httpreverseproxyserverresponse.log --err=attachment-nunit-error-sslstrip_httpreverseproxyserverresponse.log --framework=4.0 --noresult --noheader --test=httpreverseproxyserverresponse
                echo msbuild error level is %errorlevel%
                exit /b %errorlevel%
                
                                
              
            tests_onpostclientheadersrequest:
              ignore-state: false
              start-when:
                - script: build_testssslstrip   
                  states: [passed]                
              body: |
                nunit3-console tests\TestsSslStrip\bin\debug\TestsSslStrip.dll --output=attachment-nunit-sslstrip_onpostclientheadersrequest-info.log --err=attachment-nunit-error-sslstrip_onpostclientheadersrequest_.log --framework=4.0 --noresult --noheader --test=onpostclientheadersrequest
                echo msbuild error level is %errorlevel%
                exit /b %errorlevel%
                
                                
              
            tests_onpostserverheadersresponse:
              ignore-state: false
              start-when:
                - script: build_testssslstrip   
                  states: [passed]                
              body: |
                nunit3-console tests\TestsSslStrip\bin\debug\TestsSslStrip.dll --output=attachment-nunit-info-sslstrip_onpostserverheadersresponse.log /err=attachment-nunit-error-sslstrip_onpostserverheadersresponse.log --framework=4.0 --noresult --noheader --test=onpostserverheadersresponse
                echo msbuild error level is %errorlevel%
                exit /b %errorlevel%
                
                
                
